<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<title>remoteStorage spec</title>
	
	<link rel="stylesheet" href="../css/reset.css">
	<link rel="stylesheet" href="../css/donate.css">
</head>

<body>
	<div id="toplight"></div>

<div class="wrapper">

	<header class="minimal">
		<h1><a href="http://unhosted.org">UNHOSTED</a></h1>
		<h2>DEPRECATED<h2>
    See <a href="http://www.w3.org/community/unhosted/wiki/RemoteStorage">remoteStorage</a>
	</header>
	
	<article id="webDAV">
		<h2>The remoteStorage spec</h2>
		<a href="https://github.com/unhosted/unhosted.github.com/blob/master/html/spec/change7.html">v1.0.7</a>
		<ul class="index">
			<li><a class="scrollPage" href="#intro">Introduction</a></li>
			<li><a class="scrollPage" href="#finger">WebFinger</a></li>
			<li><a class="scrollPage" href="#oauth">OAuth2-cs</a></li>
			<li><a class="scrollPage" href="#KV">Key-value store</a></li>
			<li><a class="scrollPage" href="#redirects">Requiring redirect support</a></li>
			<li><a class="scrollPage" href="#JSON">Requiring JSON payloads</a></li>
			<li><a class="scrollPage" href="#resumable">Requiring resumable uploads</a></li>
			<li><a class="scrollPage" href="#conclusion">Conclusion</a></li>
		</ul>
		
		<h3><a id="intro">Introduction</a></h3>
		<p>A remoteStorage service acts as an always-on data storage
		for its users. It does not host any application source code, nor does it execute
		any processing.
		 To make use of a remoteStorage account, the user visits html apps 
		that run in a browser, or user-agent. This user-agent discovers the user's
		remoteStorage service through WebFinger. It then redirects the user to an OAuth
		dialogue, to establish authorization. Finally, it uses the GET, PUT and DELETE verbs of WebDAV
		to read and write the data on the remoteStorage account.
		</p>
		<p>This document is meant for implementers of a
		<strong>remoteStorage service</strong>. It descibes how a remoteStorage
		service should behave. <strong>Developers</strong> of html apps should
		include <a href="http://unhosted.org/remoteStorage.js">remoteStorage.js</a> and use its
		<a href="http://unhosted.org/api.html">API</a>.
		<strong>End-users</strong> who are interested in understanding the concepts
		behind the unhosted web, are better off reading this <a 
		href="http://blogs.fsfe.org/fellowship-interviews/?p=299">interview</a>. In any case, follow our <a
		href="https://groups.google.com/group/unhosted">mailing list</a> for all the latest updates.  </p> <p> In order
		for your service to comply with the remoteStorage standard, it needs to
		implement <strong>WebFinger, OAuth2-cs, GET/PUT/DELETE, and
		CORS</strong>. All of these technologies should be configured to work together
		in the way that this specification describes using the keywords "MUST", "SHOULD"
		and "SHOULD EITHER .. OR", in the meaning specified by <a
		href="http://tools.ietf.org/html/rfc2119">rcf2119</a>.  </p> <p>Throughout this
		text, we use several variables, which are written in capitals, and with a $-sign
		in front of them. They describe the interaction between a user, this user's
		remoteStorage, and an application. The
		variables are: </p> <ul>
		<li><strong>$KV</strong> - the base URL of the key-value store.</li>
		<li><strong>$AUTH</strong> - the URL for the OAuth2-cs dialog.</li>
		<li><strong>$TYPE</strong> - either 'public' or 'private'.</li>
		<li><strong>$TYPE-MODIFIERS</strong> - zero or more of ['redirects', 'resumable', 'json'], each preceded by '/'.</li>
		<li><strong>$DATASCOPE</strong> - the string identifying the resource to which
		the user is granting the application access.</li>
		</ul>
		
		<h3><a id="finger">WebFinger</a></h3>

		<p>The remoteStorage service MUST
		implement <a
		href="http://code.google.com/p/webfinger/wiki/WebFingerProtocol">WebFinger</a>.
                In the WebFinger data for the user's <strong>user address</strong> (user@host),
		it should add a link element with
		<strong>rel</strong>-attribute
		'<strong>http://w3.org/ns/remoteStorage</strong>'.
		The link should have a <strong>template</strong> attribute containing a url template with the string '{scope}' in it,
		which we shall call <strong>$KV</strong>,
		an <strong>auth</strong> attribute containing a url which we shall call <strong>$AUTH</strong>,
		and a <strong>type</strong> attribute containing the string <strong>$TYPE</strong>, optionally followed by a
		<strong>TYPE-MODIFIERS</strong> string.
		All webfinger resources MUST be served with <a
		href="http://www.w3.org/TR/cors/">CORS</a> headers that allow their retrieval
		from any origin. The link should also have an 'auth' attribute pointing to  </p>

		<h3><a id="oauth">OAuth2-cs</a></h3>
		<p>The remoteStorage implementer MUST make <a
		href="http://tools.ietf.org/html/draft-ietf-oauth-v2-13#section-4.2">OAuth2-cs</a>
		available on <strong>$AUTH</strong> announced in the lrdd link's auth attribute (no need for CORS headers
		here, because OAuth does redirection and not AJAX).
		The resource scope for OAuth should always be either <strong>$DATASCOPE</strong>
		(the same string as the data scope that will be accessed), or the wildcard symbol '*'. In the first
		case, the user should be informed that they are giving the app in question read/write access to the
		given data scope.
		In the second case, the user should be informed that they are giving the app in question read/write access to
		all current and future data scopes.
		</p>

		<h3><a id="KV">Key-value store</a></h3>
		<p>Whenever a user grants an app access to a <strong>$DATASCOPE</strong>, the remoteStorage
		implementer MUST make a key-value store available on
		the URL obtained by taking the template <strong>$KV</strong> and replacing '{scope}' with
		<strong>$DATASCOPE/</strong>, implementing the GET, PUT and DELETE verbs of the WebDAV protocol,
		with CORS headers that allow any app that sends it a valid
		bearer token in the http request headers.
		If <strong>$TYPE</strong> is 'public', the
		key-value store should allow GET requests (as well as HEAD and OPTIONS) without any
		bearer token in the http request headers. That's to say, the OAuth token gives
		the bearer write-access, but all data is publicly readable.
		If <strong>$TYPE</strong> is 'private', then all verbs except OPTIONS should require
		credentials.
			</p>
		<h3><a id="redirects">Requiring redirects support</a></h3>
		<p>If <strong>$TYPE-MODIFIERS</strong> contains 'redirects', the key-value
		store can reply to a PUT call with a redirect http code, plus a 'Location:' headers, to indicate under
		which key the new value was stored.
		</p> 
		<h3><a id="JSON">Requiring JSON payloads</a></h3>
		<p>By default, the key-value store should accept any valid POST data as the payload for PUT calls. However,
		if <strong>$TYPE-MODIFIERS</strong> contains 'json', it is only required to allow valid UTF-8 JSON. Furthermore,
		if it then replies to any PUT with a JSON-object containing a 'rev' field, then it can require that any subsequent
		PUT calls contain that a UTF-8 JSON object with that same value as a '_rev' field. See <a href="http://wiki.apache.org/couchdb/HTTP_Document_API#PUT">CouchDb</a> for an example of a key-value store that relies on the 'json' type modifier.</p>

		<h3><a id="resumable">Requiring resumable uploads</a></h3>
		<p>[UNDER CONSTRUCTION] Including 'resumable' in <strong>$TYPE-MODIFIERS</strong> means the key-value store only
		needs to implement resumable uploads. See <a href="http://code.google.com/apis/documents/docs/3.0/developers_guide_protocol.html#UploadingDocs">Google Drive</a> for an example of a key-value store that relies on the 'resumable' type modifier.
		</p> 

		<h3><a id="conclusion">Conclusion</a></h3>
		<p> A non-normative example
		implementation of this specification is currently visible by visiting <a
		href="http://unhosted.org/demo/text" target="_blank">unhosted LightWriter</a>, or
		viewing its <a href="http://unhosted.org/remoteStorage.js" target="_blank">javascript</a>,
		and <a href="httpTrace.txt" target="_blank">FIXME</a> is a stripped down
		representation of the http trace it produces. It is up to the application, and
		beyond the scope of this spec, to implement end-to-end encryption on top of
		this, possibly using the Stanford Javascript Crypto Library, possibly in a
		WebWorker process. This text may be changed for clarity - its history is tracked
		<a
		href="https://github.com/unhosted/unhosted.github.com/commits/master/html/spec/change7.html" target="_blank">here</a>.
		However, the standard it describes was frozen on <strong>20 October 2011</strong>.
		The standard will not change for at least 6 months (until at least <strong>20
		April 2011</strong>). Even then, if at any point after that improvements to
		this standard are deemed desirable, every attempt will be made to make those
		changes non-breaking.
		  </p>
	</article>
	
</div>

</body>
</html>
